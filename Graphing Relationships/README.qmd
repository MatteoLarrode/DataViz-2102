---
title: "Assignment #5 - Graphing Realtionships"
author: "Matteo Larrode"
format: 
  gfm:
    code-fold: true
    prefer-html: true
---

## Question 1: 2016 and 2020 Democratic vote shares

Let's first load the packages and data we will need for this assignment

```{r}
#| output: false

library(tidyverse)
library(haven)
library(kableExtra) #table
library(psych) #describe function
library(ggplot2)
library(ggrepel) #labeling state names

vote_2020 <- read_csv("data/us_vote_2020.csv")
dem_share_80_16 <- read_dta("data/leipvote1980_2016wide.dta")

```

Now I join the 2020 election data to democratic votes shares of the two party vote, from 1980 to 2016 to the 1980-2016.

```{r}

vote_80_16 <- left_join(dem_share_80_16, vote_2020, by = "state") %>%
  mutate(pctdem2020 = dem_percent / 100)

vote16_20 <- vote_80_16 %>%
  select(state, stateid, pctdem2016, pctdem2020)

```

Here is a table of summary statistics for the 2016 and 2020 Democratic vote shares.

```{r}
summary_stats <- describe(vote16_20[ , c('pctdem2016', 'pctdem2020')], fast = TRUE) %>%
  as.data.frame() %>%
  select(-vars) %>%
  mutate(across(-n, ~ . * 100))
  

rownames(summary_stats) <- c("2016", "2020")

   


# Create HTML table
table1 <- kbl(summary_stats, format = "html", align = "c", caption = "Summary Statistics for Democratic Vote Shares (2016-2020)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), 
                full_width = F,
                fixed_thead = T)

table1
```

We can see that there was a slight increase, on average, in the percentage of the two-party vote that went to the Democratic presidential candidate from 2016 to 2020. The mean percentage increased from 47.99% in 2016 to 48.65% in 2020, and the minimum percentage increased too. The standard deviation and range decreased as well, suggesting that there was slightly less variability in the percentage of the two-party vote that went to the Democratic presidential candidate across all states in 2020 compared to 2016.

## Question 2: Scatter plot

Now let us generate the vote swing scatter plot with the 2020 Democratic percentage of the vote on the Y axis and the 2016 Democratic percentage of the vote on the X axis. 

```{r, dpi = 150}
#| warning: false

plot1 <- ggplot(vote16_20, aes(x = pctdem2016*100, y = pctdem2020*100)) +
  geom_point() +
  geom_text_repel(aes(label = state),
                  max.overlaps = Inf) +
  theme(text=element_text(family="Roboto"),
        panel.background = element_blank(),
        plot.margin = unit(c(0, 0.5, 0.5, 0.5), "cm"),
        plot.title=element_text(hjust=0.5, face="bold", size=12, margin = margin(b=10)),
        plot.caption = element_text(size=9, vjust = -2),
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "gray", linetype = "dashed", linewidth = 0.2))+
  labs(x = "2016 Democratic Vote %", 
       y = "2020 Democratic Vote %",
       title = "Vote for the Democratic Presidential Candidate in 2016 and 2020",
       caption = "@matteoStats") + # axis labels
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "red") # add 45 degree line


plot1
```
Even using the {ggrepel} package to label state names, the plot is too crowded! In order to be able to read and describe the graph, let us try labeling only 10 states. To bring more insight on states that experienced change, I will choose those with the highest difference between 2016 and 2020. 

```{r}

vote16_20_new <- vote16_20 %>%
  mutate(pct_diff = abs(pctdem2020 - pctdem2016),
         #use rank function
         top_10 = ifelse(rank(desc(pct_diff)) <= 10, TRUE, FALSE))

```

Now let us plot the new graph, with less state labels.

```{r, dpi = 150}
#| warning: false

plot2 <- ggplot(vote16_20_new, aes(x = pctdem2016*100, y = pctdem2020*100, col = top_10)) +
  geom_point() +
  geom_text_repel(data = filter(vote16_20_new, top_10),
                  aes(label = state),
                  #get labels away from the points
                  position = position_nudge_repel(y = 1)) +
  theme(text=element_text(family="Roboto"),
        panel.background = element_blank(),
        plot.margin = unit(c(0, 0.5, 0.5, 0.5), "cm"),
        plot.title=element_text(hjust=0.5, face="bold", size=12, margin = margin(b=10)),
        plot.caption = element_text(size=9, vjust = -2),
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "gray", linetype = "dashed", linewidth = 0.2),
        legend.position = "none")+
  scale_color_manual(values = c("grey", "black"))+
  labs(x = "2016 Democratic Vote %", 
       y = "2020 Democratic Vote %",
       title = "Vote for the Democratic Presidential Candidate in 2016 and 2020",
       caption = "@matteoStats") + # axis labels
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "red") # add 45 degree line


plot2
```
The points above the 45-degree line indicate a gain in Democratic votes between 2016 and 2020, while points below the line indicate a loss in Democratic votes. From the plot, we can see that most states had a higher percentage of Democratic votes in 2020 compared to 2016, as indicated by the majority of points above the 45-degree line. Some notable exceptions include California, and Hawaii, where the Democratic vote share decreased from 2016 to 2020. 

The choice of states to label does leave out some information. For example, it is interesting to note that some traditionally Republican states, such as Arizona and Georgia, had a significant gain in Democratic votes in 2020. Overall, this plot provides a useful visual representation of the changing political landscape in the United States between the 2016 and 2020 presidential elections.

At the top-right corner of the plot, the state of Washington, D.C. seems like an outlier. For both 2016 and 2020, it has a much higher percentage of vote for the Democrat candidate than the other states. Let us try to omit this state for the next plot. 

```{r, dpi = 150}
#| warning: false

plot3 <- ggplot(data = filter(vote16_20_new, state != "District of Columbia"),
                aes(x = pctdem2016*100, y = pctdem2020*100, col = top_10)) +
  geom_point() +
  geom_text_repel(data = filter(vote16_20_new, top_10 & state != "District of Columbia"),
                  aes(label = state),
                  #get labels away from the points
                  position = position_nudge_repel(y = 1)) +
  theme(text=element_text(family="Roboto"),
        panel.background = element_blank(),
        plot.margin = unit(c(0, 0.5, 0.5, 0.5), "cm"),
        plot.title=element_text(hjust=0.5, face="bold", size=12, margin = margin(b=10)),
        plot.caption = element_text(size=9, vjust = -2),
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "gray", linetype = "dashed", linewidth = 0.2),
        legend.position = "none")+
  scale_color_manual(values = c("grey", "black"))+
  labs(x = "2016 Democratic Vote %", 
       y = "2020 Democratic Vote %",
       title = "Vote for the Democratic Presidential Candidate in 2016 and 2020 (without DC)",
       caption = "@matteoStats") + # axis labels
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "red") # add 45 degree line


plot3
```

The effect of removing Washington D.C. is that the points of the scatter plot are less tightly clustered. Removing the outlier - DC - helps to get a clearer view of the evolution of the vote for the Democrat candidate between 2016 and 2020 in the other states. 


## Question 3

Again using the data from 1, filter out Washington D.C., reshape the data from wide form to long form using pivot_longer() and generate a line plot for the 50 states from 1980 to 2020, graphing percent Democratic on the y-axis and year on the x-axis. Choose a set of states that you find interesting, and emphasize those states using colors.
Describe the overall patterns in the data over time. What central features are particularly noteworthy, and why?
What story are you telling with your use of color to highlight a set of states?
Remember that in section 7.1, Healy faceted his election graph by the four census regions. Generate a second graph structured as before, this time faceting by census region.

```{r}


```


## Question 4: Final Project Data

Now using some data that you would like to use in your final project, answer the following:
Describe in detail the source of your data.
What question do you want to ask? That is, what is your research question, or, put differently, what question will your graph answer?
Create a scatterplot (or alternative graph, as appropriate) that illustrates the relationship between your outcome of interest and your main independent variable of interest. Describe the graph in a paragraph. What story does the graph convey?


```{r, dpi = 150}


```
